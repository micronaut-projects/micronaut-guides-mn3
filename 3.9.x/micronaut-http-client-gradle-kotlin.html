<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Micronaut HTTP Client</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-http-client.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Micronaut HTTP Client"/>
    <meta name="twitter:description" content="Learn how to use Micronaut low-level HTTP Client. Simplify your code with the declarative HTTP client."/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="./index.html" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="./index.html" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/blog/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-http-client.html">Micronaut HTTP Client</a> » <span class="breadcrumb_last" aria-current="page">gradle | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-application">4. Writing the Application</a>
<ul class="sectlevel2">
<li><a href="#github-api">4.1. GitHub API</a></li>
<li><a href="#low-level-client">4.2. Low Level Client</a></li>
<li><a href="#declarative-client">4.3. Declarative Client</a></li>
<li><a href="#controller">4.4. Controller</a></li>
<li><a href="#tests">4.5. Tests</a></li>
</ul>
</li>
<li><a href="#testing-the-application">5. Testing the Application</a></li>
<li><a href="#http-client-filter">6. HTTP Client Filter</a>
<ul class="sectlevel2">
<li><a href="#configuration-parameters">6.1. Configuration Parameters</a></li>
</ul>
</li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#native-executable-generation">7.1. Native executable generation</a></li>
</ul>
</li>
<li><a href="#next-steps">8. Next steps</a></li>
<li><a href="#help-with-the-micronaut-framework">9. Help with the Micronaut Framework</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Micronaut HTTP Client</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn how to use Micronaut low-level HTTP Client. Simplify your code with the declarative HTTP client.</p>
</div>
<div class="paragraph">
<p>Authors: Sergio del Amo, Iván López</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 3.9.2</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will create a Micronaut application written in Kotlin to consume the GitHub API with the Micronaut HTTP Client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-http-client-gradle-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-application">4. Writing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an application using the <a href="https://docs.micronaut.io/latest/guide/#cli">Micronaut Command Line Interface</a> or with <a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide \
    --features=reactor,graalvm,serialization-jackson \
    --build=gradle
    --lang=kotlin</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle is used as the build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as the language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut application with the default package <code>example.micronaut</code> in a directory named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you use Micronaut Launch, select Micronaut Application as application type and add <code>reactor</code>, <code>graalvm</code>, and <code>serialization-jackson</code> features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have an existing Micronaut application and want to add the functionality described here, you can <a href="https://micronaut.io/launch?features=reactor&amp;features=graalvm&amp;features=serialization-jackson&amp;lang=KOTLIN&amp;build=GRADLE&amp;test=JUNIT&amp;name=micronautguide&amp;type=DEFAULT&amp;package=example.micronaut&amp;activity=diff" target="_blank" rel="noopener">view the dependency and configuration changes from the specified features</a> and apply those changes to your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://guides.micronaut.io/latest/micronaut-intellij-idea-ide-setup.html">Setup IntelliJ IDEA to develop Micronaut Applications</a>.</p>
</div>
<div class="sect2">
<h3 id="github-api">4.1. GitHub API</h3>
<div class="paragraph">
<p>In this guide, you will consume the <a href="https://docs.github.com/en/rest">GitHub API</a> from a Micronaut application.</p>
</div>
<div class="paragraph">
<p>In particular, we consume the <a href="https://docs.github.com/en/rest/reference/repos#list-releases">List releases</a> endpoint.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This returns a list of releases, which does not include regular Git tags that have not been associated with a release.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This API resource can be consumed by both authenticated and anonymous clients.</p>
</div>
<div class="paragraph">
<p>Initially, you will consume it anonymously, later we will discuss authentication.</p>
</div>
<div class="paragraph">
<p>Modify <code>src/main/resources/application.yml</code> to create some configuration parameters.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">github</span>:
  <span class="key">organization</span>: <span class="string"><span class="content">micronaut-projects</span></span>
  <span class="key">repo</span>: <span class="string"><span class="content">micronaut-core</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add configuration to associate a service identifier to the GitHub API URL.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">micronaut</span>:
  <span class="key">http</span>:
    <span class="key">services</span>:
      <span class="key">github</span>:
        <span class="key">url</span>: <span class="string"><span class="content">'https://api.github.com'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To encapsulate type-safe configuration retrieval, we use a <a href="https://docs.micronaut.io/latest/guide/#configurationProperties"><code>@ConfigurationProperties</code></a> object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubConfiguration.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.context.annotation.Requires

@ConfigurationProperties(GithubConfiguration.PREFIX)
@Requires(property = GithubConfiguration.PREFIX)
class GithubConfiguration {
    var organization: String? = null
    var repo: String? = null
    var username: String? = null
    var token: String? = null

    companion object {
        const val PREFIX = &quot;github&quot;
        const val GITHUB_API_URL = &quot;https://api.github.com&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this guide, you will fetch <a href="https://github.com/micronaut-projects/micronaut-core/releases">Micronaut Core releases</a>.</p>
</div>
<div class="paragraph">
<p>To consume the GitHub API, you will use Micronaut HTTP Client.</p>
</div>
</div>
<div class="sect2">
<h3 id="low-level-client">4.2. Low Level Client</h3>
<div class="paragraph">
<p>Initially, you will create a Bean which uses the low-level Client API.</p>
</div>
<div class="paragraph">
<p>Create a POJO to parse the JSON response into an object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubRelease.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.serde.annotation.Serdeable

@Serdeable
data class GithubRelease(val name: String, val url: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>GithubLowLevelClient</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubLowLevelClient.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpHeaders.ACCEPT
import io.micronaut.http.HttpHeaders.USER_AGENT
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.http.uri.UriBuilder
import jakarta.inject.Singleton
import reactor.core.publisher.Mono
import java.net.URI

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class GithubLowLevelClient(@param:Client(id = &quot;github&quot;) private val httpClient: HttpClient,  <i class="conum" data-value="2"></i><b>(2)</b>
                           configuration: GithubConfiguration) {  <i class="conum" data-value="3"></i><b>(3)</b>
    private val uri: URI = UriBuilder.of(&quot;/repos&quot;)
        .path(configuration.organization)
        .path(configuration.repo)
        .path(&quot;releases&quot;)
        .build()

    fun fetchReleases(): Mono&lt;List&lt;GithubRelease&gt;&gt; {
        val req: HttpRequest&lt;*&gt; = HttpRequest.GET&lt;Any&gt;(uri) <i class="conum" data-value="4"></i><b>(4)</b>
            .header(USER_AGENT, &quot;Micronaut HTTP Client&quot;) <i class="conum" data-value="5"></i><b>(5)</b>
            .header(ACCEPT, &quot;application/vnd.github.v3+json, application/json&quot;) <i class="conum" data-value="6"></i><b>(6)</b>
        return Mono.from(httpClient.retrieve(req, Argument.listOf(GithubRelease::class.java))) <i class="conum" data-value="7"></i><b>(7)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject <code>HttpClient</code> via constructor injection. The <code>@Client</code> <code>id</code> member uses <code>github</code>; the service identifier set in the configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the previously defined configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating HTTP Requests is easy thanks to the Micronaut framework fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use <code>retrieve</code> to perform an HTTP request for the given request object and convert the full HTTP response&#8217;s body into the specified type. e.g. <code>List&lt;GithubRelease&gt;</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of <code>retrieve</code> we could have used <code>jsonStream</code>. You can use <code>jsonStream()</code> to stream arrays of type <code>application/json</code> or
JSON streams of type <code>application/x-json-stream</code>. If we use <code>retrieve</code>, such as in the previous code listing, the operation will not block.
However, it will not return until all the data has been received from the server. In the case of a JSON array that would be the whole array.
However, if you are interested in just the first element of the array, <code>jsonStream</code> provides a better alternative since it starts streaming data from the server without needing the whole response.
For example, <code>jsonStream().firstElement()</code> will only parse the first item in a JSON array. Hence it is more efficient.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="declarative-client">4.3. Declarative Client</h3>
<div class="paragraph">
<p>It is time to take a look at support for declarative clients via the Client annotation.</p>
</div>
<div class="paragraph">
<p>Create <code>GithubApiClient</code> which clearly illustrates how a declarative Micronaut HTTP Client, which is generated at compile-time, simplifies our code.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubApiClient.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.HttpHeaders.ACCEPT
import io.micronaut.http.HttpHeaders.USER_AGENT
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Header
import io.micronaut.http.annotation.Headers
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher;

@Client(id = &quot;github&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
@Headers(
    Header(name = USER_AGENT, value = &quot;Micronaut HTTP Client&quot;), <i class="conum" data-value="2"></i><b>(2)</b>
    Header(name = ACCEPT, value = &quot;application/vnd.github.v3+json, application/json&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
)
interface GithubApiClient {

    @Get(&quot;/repos/\${github.organization}/\${github.repo}/releases&quot;) <i class="conum" data-value="4"></i><b>(4)</b>
    fun fetchReleases(): Publisher&lt;GithubRelease?&gt;? <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>URL of the remote service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use configuration parameter interpolation when you define the path of the GET endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can return any reactive type of any implementation (RxJava, Reactor&#8230;&#8203;), but it&#8217;s better to use the Reactive Streams public interfaces like <code>Publisher</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="controller">4.4. Controller</h3>
<div class="paragraph">
<p>Create a Controller. It uses both (low-level and declarative clients). It showcases several Micronaut framework capabilities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Micronaut framework supports any framework that implements Reactive Streams, including RxJava, and Reactor. Thus, you can easily and efficiently compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).</p>
</li>
<li>
<p>The Framework enables you to consume/produce <a href="https://docs.micronaut.io/latest/guide/#clientStreaming">JSON Streams</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono

@Controller(&quot;/github&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
class GithubController(private val githubLowLevelClient: GithubLowLevelClient, <i class="conum" data-value="2"></i><b>(2)</b>
                       private val githubApiClient: GithubApiClient) {

    @Get(&quot;/releases-lowlevel&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
    fun releasesWithLowLevelClient(): Mono&lt;List&lt;GithubRelease&gt;&gt; { <i class="conum" data-value="4"></i><b>(4)</b>
        return githubLowLevelClient.fetchReleases()
    }

    @Get(uri = &quot;/releases&quot;, produces = [MediaType.APPLICATION_JSON_STREAM]) <i class="conum" data-value="5"></i><b>(5)</b>
    fun fetchReleases(): Publisher&lt;GithubRelease?&gt;? { <i class="conum" data-value="6"></i><b>(6)</b>
        return githubApiClient.fetchReleases()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/github</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject beans via constructor injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the index method to all requests that use an HTTP GET</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>releasesWithLowLevelClient</code> returns a <code>Mono</code> which may or may not emit an item. If an item is not emitted a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In order to do JSON streaming you can declare a controller method that returns a <code>application/x-json-stream</code> of JSON objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can return any reactive type of any implementation (RxJava, Reactor&#8230;&#8203;), but it&#8217;s better to use the Reactive Streams public interfaces like <code>Publisher</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tests">4.5. Tests</h3>
<div class="paragraph">
<p>Create a test to verify that both clients work as expected, and the controller echoes the output of the GitHub API in a Reactive way.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/GithubControllerTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.ApplicationContext
import io.micronaut.context.annotation.Requires
import io.micronaut.core.io.ResourceLoader
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.StreamingHttpClient
import io.micronaut.runtime.server.EmbeddedServer
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Assertions.assertNotNull
import org.junit.jupiter.api.Test
import java.io.InputStream
import java.util.*
import java.util.regex.Pattern

class GithubControllerTest {
    val MICRONAUT_RELEASE =
            Pattern.compile(&quot;[Micronaut|Micronaut Framework] [0-9].[0-9].[0-9]([0-9])?( (RC|M)[0-9])?&quot;)

    @Test
    fun verifyGithubReleasesCanBeFetchedWithLowLevelHttpClient() {


        val github : EmbeddedServer = ApplicationContext.run(EmbeddedServer::class.java,
            mapOf(&quot;spec.name&quot; to &quot;GithubDeclarativeControllerTest&quot;)
        ) <i class="conum" data-value="1"></i><b>(1)</b>
        val embeddedServer : EmbeddedServer  = ApplicationContext.run(EmbeddedServer::class.java,
            mapOf(&quot;micronaut.http.services.github.url&quot; to &quot;http://localhost:${github.port}&quot;)
        ) <i class="conum" data-value="2"></i><b>(2)</b>
        val httpClient : HttpClient = embeddedServer.applicationContext
            .createBean(StreamingHttpClient::class.java, embeddedServer.url)
        val client = httpClient.toBlocking()

        val request : HttpRequest&lt;Any&gt; = HttpRequest.GET(&quot;/github/releases-lowlevel&quot;)
        val rsp = client.exchange(request, <i class="conum" data-value="3"></i><b>(3)</b>
                Argument.listOf(GithubRelease::class.java)) <i class="conum" data-value="4"></i><b>(4)</b>
        assertEquals(HttpStatus.OK, rsp.status)   <i class="conum" data-value="5"></i><b>(5)</b>
        val releases = rsp.body();
        assertNotNull(releases)
        assertReleases(releases.toList()) <i class="conum" data-value="6"></i><b>(6)</b>
        httpClient.close()
        embeddedServer.close()
        github.close()
    }

    fun assertReleases(releases: List&lt;GithubRelease&gt;) {
        assertNotNull(releases)
        Assertions.assertTrue(releases
            .map { it.name }
            .all { MICRONAUT_RELEASE.matcher(it).find() })
    }

    @Requires(property = &quot;spec.name&quot;, value = &quot;GithubControllerTest&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
    @Controller
    class GithubReleases(val resourceLoader : ResourceLoader) {
        @Get(&quot;/repos/micronaut-projects/micronaut-core/releases&quot;)
        fun coreReleases() : Optional&lt;InputStream&gt; {
            return resourceLoader.getResourceAsStream(&quot;releases.json&quot;)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Combine <code>@Requires</code> and properties (either via the <code>@Property</code> annotation or by passing properties when starting the context) to avoid bean pollution.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This test mocks an HTTP Server for <code>GitHub</code> with an extra Micronaut Embedded Server. This allows you to test how your application behaves with a specific JSON response or avoid issues such as rate limits which can make your tests flaky.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sometimes, receiving just the object is not enough, and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Micronaut HTTP Client simplifies binding a JSON array to a list of POJOs by using <code>Argument::listOf</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use <code>status</code> to check the HTTP status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use <code>.body()</code> to retrieve the parsed payload.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">5. Testing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then open <code>build/reports/tests/test/index.html</code> in a browser to see the results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-client-filter">6. HTTP Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice. To simplify this, the Micronaut framework includes the ability to define <code>HttpClientFilter</code> classes that are applied to all matching HTTP clients.</p>
</div>
<div class="paragraph">
<p>For a real world example, let us provide GitHub Authentication via an <code>HttpClientFilter</code>. Follow the steps in
<a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">to create your own Personal Token</a>.
Then you can use those credentials to access the GitHub API
<a href="https://docs.github.com/en/rest/overview/other-authentication-methods#via-oauth-and-personal-access-tokens">using Basic Auth</a>.</p>
</div>
<div class="paragraph">
<p>Create a Filter:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubFilter.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

@Filter(&quot;/repos/**&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(condition = GithubFilterCondition::class) <i class="conum" data-value="2"></i><b>(2)</b>
class GithubFilter(val configuration: GithubConfiguration) : HttpClientFilter { <i class="conum" data-value="3"></i><b>(3)</b>

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;?&gt; {
        return chain.proceed(request.basicAuth(configuration.username, configuration.token)) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Supply the pattern you want to match to the <code>@Filter</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kotlin doesn&#8217;t support runtime repeatable annotations (see <a href="https://youtrack.jetbrains.com/issue/KT-12794">KT-12794</a>. We use a custom condition to enable the bean where appropriate.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection of the configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enhance every request sent to GitHub API providing Basic Authentication.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a custom Condition:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubFilterCondition.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.condition.Condition
import io.micronaut.context.condition.ConditionContext
import io.micronaut.context.exceptions.NoSuchBeanException

class GithubFilterCondition : Condition { <i class="conum" data-value="1"></i><b>(1)</b>

    override fun matches(context: ConditionContext&lt;*&gt;?): Boolean {
        if (context != null &amp;&amp; context.beanContext != null) {
            try {
                val githubConfiguration: GithubConfiguration =
                    context.beanContext.getBean(GithubConfiguration::class.java) <i class="conum" data-value="2"></i><b>(2)</b>
                if (githubConfiguration.token != null &amp;&amp; githubConfiguration.username != null) {
                    return true <i class="conum" data-value="3"></i><b>(3)</b>
                }
            } catch (e: NoSuchBeanException) {
            }
        }
        return false
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Implement Micronaut <code>Condition</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>GithubConfiguration</code> bean from the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Only return <code>true</code> when the <code>token</code> and the <code>username</code> exist.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuration-parameters">6.1. Configuration Parameters</h3>
<div class="paragraph">
<p>Add your GitHub <code>username</code> and <code>token</code> to <code>src/main/resource/application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">github</span>:
  <span class="key">organization</span>: <span class="string"><span class="content">micronaut-projects</span></span>
  <span class="key">repo</span>: <span class="string"><span class="content">micronaut-core</span></span>
  <span class="key">username</span>: <span class="string"><span class="content">yourgithubusername</span></span>
  <span class="key">token</span>: <span class="string"><span class="content">xxxxxxxxxxxx</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a logger to <code>src/main/resources/logback.xml</code> to see the HTTP client output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.http.client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run again the tests, you will see the that the Filter is invoked and HTTP Basic Auth is used against GitHub API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">13:09:56.662 [default-nioEventLoopGroup-1-4] DEBUG i.m.h.client.netty.DefaultHttpClient - Sending HTTP GET to https://api.github.com/repos/micronaut-projects/micronaut-core/releases
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - User-Agent: Micronaut HTTP Client
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Accept: application/json
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Authorization: Basic xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
13:09:56.664 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - host: api.github.com</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">7. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, the polyglot embeddable virtual machine, to generate a native executable of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling native executables ahead of time with GraalVM improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="native-executable-generation">7.1. Native executable generation</h3>
<div class="paragraph">
<p>The easiest way to install GraalVM on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 11</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r11-grl</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you still use Java 8, use the JDK11 version of GraalVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Java 17</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r17-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/22.0/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>After installing GraalVM, install the <code>native-image</code> component, which is not installed by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a native executable using Gradle, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew nativeCompile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in <code>build/native/nativeCompile</code> directory and can be run with <code>build/native/nativeCompile/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the name of the native executable or pass additional parameters to GraalVM:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graalvmNative {
    binaries {
        main {
            imageName.set(<span class="string"><span class="delimiter">'</span><span class="content">mn-graalvm-application</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
            buildArgs.add(<span class="string"><span class="delimiter">'</span><span class="content">--verbose</span><span class="delimiter">'</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The native executable name will now be <code>mn-graalvm-application</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to pass extra arguments to build the native executable</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">8. Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Visit <a href="https://docs.micronaut.io/latest/guide/#httpClient">Micronaut HTTP Client documentation</a> to learn more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-micronaut-framework">9. Help with the Micronaut Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://micronaut.io/foundation/">Micronaut Foundation</a> sponsored the creation of this Guide. A variety of <a href="https://micronaut.io/commercial-support/">consulting and support services</a> are available.</p>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://matrix.to/#/#micronautfw_questions:gitter.im"><i class="fab fa-gitter"><span class="sr-only">Gitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2023 MICRONAUT FOUNDATION. ALL RIGHTS RESERVED</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
