<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Micronaut Server generation with OpenAPI</title>
    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
    <link href="guide.css" rel="stylesheet" />
    <script src="guide.js"></script>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://guides.micronaut.io/latest/images/cards/micronaut-openapi-generator-server.png"/>
    <meta name="twitter:creator" content="@micronautfw"/>
    <meta name="twitter:site" content="@micronautfw"/>
    <meta name="twitter:title" content="Micronaut Server generation with OpenAPI"/>
    <meta name="twitter:description" content="Learn how to write an OpenAPI definition, use it to generate a server template for a Micronaut application, and get it all to work"/>
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="./index.html" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="./index.html" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/blog/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="./index.html">Guides</a> » <a href="micronaut-openapi-generator-server.html">Micronaut Server generation with OpenAPI</a> » <span class="breadcrumb_last" aria-current="page">maven | java</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        
<ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#what-openapi-is">1.1. What OpenAPI Is</a></li>
<li><a href="#advantages-of-openapi">1.2. Advantages Of OpenAPI</a></li>
<li><a href="#what-the-openapi-generator-is">1.3. What The OpenAPI Generator Is</a></li>
<li><a href="#what-you-will-learn">1.4. What You Will Learn</a></li>
<li><a href="#solution">1.5. Solution</a></li>
</ul>
</li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#installing-openapi-generator">3. Installing OpenAPI Generator</a></li>
<li><a href="#creating-the-api-definition-file">4. Creating The API Definition File</a>
<ul class="sectlevel2">
<li><a href="#describing-general-server-info">4.1. Describing General Server Info</a></li>
<li><a href="#defining-paths-and-operations">4.2. Defining Paths And Operations</a></li>
<li><a href="#defining-schemas">4.3. Defining Schemas</a></li>
</ul>
</li>
<li><a href="#generating-server-api-from-the-openapi-definition">5. Generating Server API From The OpenAPI Definition</a></li>
<li><a href="#application-structure">6. Application Structure</a></li>
<li><a href="#data-storage-and-access-with-mysql-and-jdbc">7. Data Storage And Access With MySQL and JDBC</a>
<ul class="sectlevel2">
<li><a href="#configure-access-for-a-data-source">7.1. Configure Access for a Data Source</a></li>
<li><a href="#database-migration-with-flyway">7.2. Database Migration with Flyway</a></li>
<li><a href="#creating-a-mappedentity">7.3. Creating a MappedEntity</a></li>
<li><a href="#writing-a-repository">7.4. Writing a Repository</a></li>
</ul>
</li>
<li><a href="#writing-the-controller-logic">8. Writing the Controller Logic</a>
<ul class="sectlevel2">
<li><a href="#implementing-controller-methods">8.1. Implementing Controller Methods</a></li>
</ul>
</li>
<li><a href="#test-resources">9. Test Resources</a></li>
<li><a href="#running-the-application">10. Running the Application</a></li>
<li><a href="#testing-the-application">11. Testing the Application</a>
<ul class="sectlevel2">
<li><a href="#testing-models">11.1. Testing Models</a></li>
<li><a href="#testing-the-controller">11.2. Testing the Controller</a></li>
</ul>
</li>
<li><a href="#generate-a-micronaut-application-native-executable-with-graalvm">12. Generate a Micronaut Application Native Executable with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#native-executable-generation">12.1. Native executable generation</a></li>
</ul>
</li>
<li><a href="#next-steps">13. Next steps</a>
<ul class="sectlevel2">
<li><a href="#learn-more">13.1. Learn More</a></li>
<li><a href="#add-security">13.2. Add Security</a></li>
<li><a href="#generate-micronaut-client">13.3. Generate Micronaut Client</a></li>
<li><a href="#add-server-url-information">13.4. Add Server URL Information</a></li>
<li><a href="#generate-user-friendly-documentation">13.5. Generate User-Friendly Documentation</a></li>
</ul>
</li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Micronaut Server generation with OpenAPI</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn how to write an OpenAPI definition, use it to generate a server template for a Micronaut application, and get it all to work</p>
</div>
<div class="paragraph">
<p>Authors: Andriy Dmytruk</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 3.9.2</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, we will write an OpenAPI definition file and then use it to generate a Java Micronaut server API with OpenAPI Generator.</p>
</div>
<div class="paragraph">
<p>Then we will add internal logic to the API and test our implementation.</p>
</div>
<div class="sect2">
<h3 id="what-openapi-is">1.1. What OpenAPI Is</h3>
<div class="paragraph">
<p>The <a href="https://oai.github.io/Documentation/start-here.html">OpenAPI Specification</a> defines a format for uniquely describing REST APIs that is both human- and machine-readable. Later in this guide, we will discover the structure of documents in the OpenAPI format. We will also create such a document for our desired API. Note that we will refer to the document describing our API as an <strong>API definition</strong> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="advantages-of-openapi">1.2. Advantages Of OpenAPI</h3>
<div class="ulist">
<ul>
<li>
<p>It provides a unique way of describing a REST API that is easy to understand and modify. It is the most broadly adopted industry standard for describing new APIs and has the most developed tooling ecosystem.</p>
</li>
<li>
<p>You can generate interactive documentation and client implementations from the same definition file in numerous languages.</p>
</li>
<li>
<p>You can use the same definition file to generate a server template. The template will include client-server communication specifics based on your API definition. It removes the need for developers to write extensive documentation about each possible path and parameter for the APIs - most can be described in the definition file. This prevents incompatibility issues between the client and server sides which might be caused by ill-communication.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The internal server logic cannot be generated from a definition file and needs to be implemented manually based on the generated server template. The reason for this is very simple: there cannot be a unified way of describing all the possible server implementations.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-the-openapi-generator-is">1.3. What The OpenAPI Generator Is</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>OpenAPI Generator allows the generation of API client libraries (SDK generation), server stubs, documentation, and configuration automatically given an OpenAPI Spec (both 2.0 and 3.0 are supported).</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="what-you-will-learn">1.4. What You Will Learn</h3>
<div class="ulist">
<ul>
<li>
<p>You will discover the general structure of a document in the OpenAPI format and a definition file in this format describing the desired API for our custom server.</p>
</li>
<li>
<p>You will learn to use the <a href="https://openapi-generator.tech/">OpenAPIGenerator</a> to generate Micronaut code in Java for the server application. We will extend the code by implementing internal logic and testing it.</p>
</li>
<li>
<p>You will learn how to use Micronaut Data JDBC to connect to a MySQL database from our application to store and retrieve data. You will complement the application with tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="solution">1.5. Solution</h3>
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step. However, you can directly get the complete solution by downloading and unzipping <a href="micronaut-openapi-generator-server-maven-java.zip">micronaut-openapi-generator-server-maven-java.zip</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> <a href="https://www.baeldung.com/java-home-on-windows-7-8-10-mac-os-x-linux">configured appropriately</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></div><div class="row"><div class="col-md-12"><div class="sect1">
<h2 id="installing-openapi-generator">3. Installing OpenAPI Generator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use OpenAPI Generator, we need to <a href="https://github.com/OpenAPITools/openapi-generator#1---installation">install OpenAPI Generator CLI</a>.</p>
</div>
<div class="paragraph">
<p>We will use the jar option. <a href="https://github.com/OpenAPITools/openapi-generator#13---download-jar">Download it</a> and store it in the directory that you want to use for this project.</p>
</div>
<div class="paragraph">
<p>Next, open terminal in the same directory. To verify that generator works correctly run the <code>help</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar openapi-generator-cli-XXX.jar help</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should provide a description and a list of commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the options for installation are given at the <a href="https://openapi-generator.tech/docs/installation">"CLI Installation" guide on the OpenAPI Generator website</a>.</p>
</div>
<div class="paragraph">
<p>In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>brew install openapi-generator</code> for Homebrew installation,</p>
</li>
<li>
<p>or read the <a href="https://openapi-generator.tech/docs/installation/#bash-launcher-script">"Bash Launcher Script" section</a>
to set up a bash script with automatic updates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you installed the generator with a package manager or bash launcher script, simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openapi-generator-cli help</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the <a href="https://openapi-generator.tech/docs/online">OpenAPI Generator Online Service</a> but its usage
is not covered by this guide.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-api-definition-file">4. Creating The API Definition File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will now create a definition file that will describe our server API, including the available paths and operations.</p>
</div>
<div class="paragraph">
<p>The definition file must be in the OpenAPI format. The document must have a specific structure. <a href="https://oai.github.io/Documentation/specification.html">"OpenAPI Specification" guide</a> describes it with more detail. We will write sections of the definition document based on the specification.</p>
</div>
<div class="paragraph">
<p>OpenAPI generator supports <code>.yaml</code> and <code>.json</code> file formats for the definition file. We will use YAML due to its simplicity and human readability.</p>
</div>
<div class="paragraph">
<p>In the directory where you downloaded the OpenAPI generator CLI, create a file named <code>library-definition.yaml</code> and open it in your favourite text editor.</p>
</div>
<div class="sect2">
<h3 id="describing-general-server-info">4.1. Describing General Server Info</h3>
<div class="paragraph">
<p>We will first provide general server information in the definition file. Paste the following text to the file:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/library-definition.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">openapi</span>: <span class="string"><span class="content">3.0.0 </span></span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="key">info</span>: <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="key">description</span>: <span class="string"><span class="content">This is a library API</span></span>
  <span class="key">version</span>: <span class="string"><span class="content">1.0.0</span></span>
  <span class="key">title</span>: <span class="string"><span class="content">Library</span></span>
  <span class="key">license</span>:
    <span class="key">name</span>: <span class="string"><span class="content">Apache-2.0</span></span>
    <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.apache.org/licenses/LICENSE-2.0.html</span><span class="delimiter">&quot;</span></span>
<span class="key">tags</span>: <i class="conum" data-value="3"></i><b>(3)</b>
  - <span class="string"><span class="content">name: books</span></span>
    <span class="key">description</span>: <span class="string"><span class="content">Search for books and add new ones</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The version that will be used for parsing.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The info object contains general information about the API like a short description and license. In this case, we will be creating a website for a library.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tags will be used to logically structure different paths.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are new to OpenAPI, you might be interested in reading the <a href="https://swagger.io/docs/specification/about/">OpenAPI guide</a> or the <a href="https://swagger.io/specification/">OpenAPI 3.0.0 specification</a> after you finish this guide.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="defining-paths-and-operations">4.2. Defining Paths And Operations</h3>
<div class="paragraph">
<p>The paths section of the definition is described in the <a href="https://oai.github.io/Documentation/specification-paths.html">"API Endpoints" OpenAPI Guide</a>, but can also be understood from a few examples. This section defines paths and various operations (like <code>GET</code>, <code>PUT</code>, and <code>POST</code>) available on these paths.</p>
</div>
<div class="paragraph">
<p>We will proceed by defining a path that is supposed to be used for searching books in our library. The parameters that we will define in the definition will be used to narrow the search results.</p>
</div>
<div class="paragraph">
<p>Paste the following to our file:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/library-definition.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">paths</span>:

  <span class="key">/search</span>:
    <span class="key">get</span>: <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">tags</span>: 
        - <span class="string"><span class="content">books </span></span><i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">summary</span>: <span class="string"><span class="content">Search for a book</span></span>
      <span class="key">operationId</span>: <span class="string"><span class="content">search </span></span><i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">parameters</span>: <i class="conum" data-value="4"></i><b>(4)</b>
        - <span class="string"><span class="content">name: book-name</span></span>
          <span class="key">in</span>: <span class="string"><span class="content">query</span></span>
          <span class="key">schema</span>: 
            <span class="key">type</span>: <span class="string"><span class="content">string</span></span>
            <span class="key">minLength</span>: <span class="string"><span class="content">3 </span></span><i class="conum" data-value="5"></i><b>(5)</b>
        - <span class="string"><span class="content">name: author-name</span></span>
          <span class="key">in</span>: <span class="string"><span class="content">query</span></span>
          <span class="key">schema</span>: 
            <span class="key">type</span>: <span class="string"><span class="content">string</span></span>
      <span class="key">responses</span>: <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span>: <i class="conum" data-value="7"></i><b>(7)</b>
          <span class="key">description</span>: <span class="string"><span class="content">Success</span></span>
          <span class="key">content</span>:
            <span class="key"><span class="delimiter">&quot;</span><span class="content">applicaton/json</span><span class="delimiter">&quot;</span></span>:
              <span class="key">schema</span>:
                <span class="key">type</span>: <span class="string"><span class="content">array, </span></span>
                <span class="key">items</span>: 
                  <span class="error">$ref</span>: <span class="error">&quot;#/components/schemas/BookInfo&quot;</span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>: <i class="conum" data-value="8"></i><b>(8)</b>
          <span class="key">description</span>: <span class="string"><span class="content">Bad Request</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define the <code>GET</code> operation on the <code>/search</code> path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the <code>books</code> tag that we previously defined. Note that for each tag a controller will be generated that will implement its operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>search</code> operation id will be used as method name for the given path.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We define two parameters of type string that the user should supply in the query.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Validation can be used on parameters. In this case, book name must contain at least three characters.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>responses</code> object describes the response codes that can be produced. It also defines the structure of body if any.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>In case of correct request, we define the body to contain a list of <code>BookInfo</code> objects. The schema for the book info object will be defined later in <code>components/schemas</code> section of the definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>"400"</code> status code will be produced by Micronaut in case of a bad request, like an incorrect type supplied or failed validation. Even though Micronaut handles it automatically and no implementation is needed on our side, we add it for a complete API specification.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can read more about parameter descriptions in the
<a href="https://swagger.io/docs/specification/describing-parameters/">"Describing Parameters" OpenAPI guide</a>.
All the available types and their validations are described in
<a href="https://swagger.io/docs/specification/data-models/data-types/">"Data Models (Schemas)" OpenAPI guide</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will define another path with a <code>POST</code> operation, that is supposed to be used to add info about a book in our library. In this case, the request will contain a body with all the book information:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/library-definition.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">/add</span>:
    <span class="key">post</span>: <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">tags</span>: <span class="string"><span class="content">[books]</span></span>
      <span class="key">summary</span>: <span class="string"><span class="content">Add a new book</span></span>
      <span class="key">operationId</span>: <span class="string"><span class="content">addBook</span></span>
      <span class="key">requestBody</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">required</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">content</span>:
          <span class="key"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>: 
            <span class="key">schema</span>: 
              <span class="error">$ref</span>: <span class="error">&quot;#/components/schemas/BookInfo&quot; </span><i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">responses</span>:
        <span class="key"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span>:
          <span class="key">description</span>: <span class="string"><span class="content">Success</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>:
          <span class="key">description</span>: <span class="string"><span class="content">Bad Request</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define the <code>POST</code> method for the <code>/add</code> path, and add the same tag <code>books</code> to it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We specify that a body is required and what are the supported content-types for it. (in this case only <code>application/json</code>, but multiple can be allowed).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We write that <code>BookInfo</code> object is required to be in the request body. We reference the same <code>BookInfo</code> schema that we will define next.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To read more about body definitions, see the
<a href="https://swagger.io/docs/specification/describing-request-body/">"Describing Request Body" OpenAPI guide</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="defining-schemas">4.3. Defining Schemas</h3>
<div class="paragraph">
<p>Schemas are required whenever a parameter, request body or a response body we want to describe needs to be an object. In that case we add a schema that defines all the properties of the object. You can find out about the format for schemas in the <a href="https://oai.github.io/Documentation/specification-content.html">"Content of Message Bodies" OpenAPI Guide</a>.</p>
</div>
<div class="paragraph">
<p>We will add schemas to our definition file:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/library-definition.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">components</span>:
  <span class="key">schemas</span>:
    <span class="key">BookInfo</span>:
      <span class="key">title</span>: <span class="string"><span class="content">Book Info </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">description</span>: <span class="string"><span class="content">Object containg all the info about a book</span></span>
      <span class="key">type</span>: <span class="string"><span class="content">object</span></span>
      <span class="key">properties</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">name</span>: <span class="string"><span class="content">{type: string}</span></span>
        <span class="key">availability</span>: <span class="string"><span class="content">{$ref: &quot;#/components/schemas/BookAvailability&quot;} </span></span><i class="conum" data-value="3"></i><b>(3)</b>
        <span class="key">author</span>: <span class="string"><span class="content">{type: string, minLength: 3}</span></span>
        <span class="key">ISBN</span>: <span class="string"><span class="content">{type: string, pattern: &quot;[0-9]{13}&quot;}</span></span>
      <span class="key">required</span>: <span class="string"><span class="content">[&quot;name&quot;, &quot;availability&quot;]</span></span>
    <span class="key">BookAvailability</span>: <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">type</span>: <span class="string"><span class="content">string</span></span>
      <span class="key">enum</span>: <span class="string"><span class="content">[&quot;available&quot;, &quot;not available&quot;, &quot;reserved&quot;]</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define the <code>BookInfo</code> schema inside then <code>components/schemas</code> section. From this schema a Java class will be generated with the same <code>BookInfo</code> class name.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We define all the properties of <code>BookInfo</code>, including required validation on them (In this case, it is a minimal length requirement on one string and a regex pattern on another). An abbreviated form is used for some YAML lists and dictionaries to reduce the number of rows and simplify readability.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We reference another schema to be used as a property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We define <code>BookAvailability</code> schema to be an enum with three available values. A Java <code>BookAvailability</code> class will be generated with given enum values based on our definition.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, schemas can be defined as enums when they can only be assigned a finite number of values. Also, you can reference other schemas as properties of a schema.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can read more about writing schemas in the
<a href="https://swagger.io/docs/specification/data-models/">"Data Models (Schemas)" OpenAPI guide</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save the file and proceed to the next part of the guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generating-server-api-from-the-openapi-definition">5. Generating Server API From The OpenAPI Definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we will generate server API files from our definition. The generated server code will be in Java and will use the Micronaut features for client-server communication.
Open the terminal in the same directory as <code>library-definition.yaml</code> file and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar openapi-generator-cli-XXX.jar generate \
    -g java-micronaut-server \<i class="conum" data-value="1"></i><b>(1)</b>
    -i library-definition.yaml \<i class="conum" data-value="2"></i><b>(2)</b>
    -o ./ \<i class="conum" data-value="3"></i><b>(3)</b>
    -p controllerPackage=example.micronaut.controller \<i class="conum" data-value="4"></i><b>(4)</b>
    -p modelPackage=example.micronaut.model \<i class="conum" data-value="5"></i><b>(5)</b>
    -p build=maven \<i class="conum" data-value="6"></i><b>(6)</b>
    -p test=junit<i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify that we will use Java Micronaut server generator.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify our OpenAPI definition file as <code>library-definition.yaml</code>, which we just created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the output directory to be the current directory (<code>./</code>).
You can specify it to be a different one if you want (e.g. <code>library-server</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We provide generator-specific properties starting with <code>-p</code>.
We want all the controllers to be generated in the <code>example.micronaut.controller</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We want all the models (data models, like <code>BookInfo</code>) to be in <code>example.micronaut.model</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We want to use maven as build tool. The supported values are <code>gradle</code>, <code>maven</code> and <code>all</code>.
If nothing is specified, both Maven and Gradle files are generated.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We want to use JUnit 5 for testing. The supported values are <code>junit</code> (JUnit 5) and <code>spock</code>.
If nothing is specified, <code>junit</code> is used by default.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to view all the available parameters for micronaut server generator, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar openapi-generator-cli-XXX.jar config-help \
    -g java-micronaut-server</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to change the definition file and regenerate files, consider setting the <code>-p generateControllerAsAbstract=true</code>
parameter (we don&#8217;t recommend doing it during this guide, though). In this case, an abstract class will be generated
for the API, while all the logic needs to be implemented in a different class (that extends the API abstract class).
Your changes won&#8217;t be overwritten by generation, but the API will be updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After running, the OpenAPI generator CLI will output information about generated files. Now you can open the directory in your favorite IDE or text editor.</p>
</div>
<div class="paragraph">
<p>You should see the following directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">./
├── docs
│   └── ... <i class="conum" data-value="1"></i><b>(1)</b>
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── example/micronaut/
│   │   │       ├── Application.java <i class="conum" data-value="2"></i><b>(2)</b>
│   │   │       ├── controller
│   │   │       │   └── BooksController.java <i class="conum" data-value="3"></i><b>(3)</b>
│   │   │       └── model
│   │   │           ├── BookAvailability.java <i class="conum" data-value="4"></i><b>(4)</b>
│   │   │           └── BookInfo.java
│   │   └── resources/
│   │       ├── application.yml <i class="conum" data-value="5"></i><b>(5)</b>
│   │       └── logback.xml
│   └── test/
│       └── java/
│           └── example/micronaut/ <i class="conum" data-value="6"></i><b>(6)</b>
│               ├── controller
│               │   └── BooksControllerTest.java
│               └── model
│                   ├── BookAvailabilityTest.java
│                   └── BookInfoTest.java
├── README.md
└── ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>docs/</code> directory contains automatically generated Markdown files with documentation about your API.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Starts the Micronaut server with detected controllers.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>BooksController</code> is generated based on paths with <code>books</code> tag. It is generated in the package we specified
for controllers earlier.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Two files are generated in the <code>models/</code> directory based on schemas we provided in the definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Config file for Micronaut is generated with a default value for server port and other parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Tests are generated for all the controllers and models.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-structure">6. Application Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To better understand the Micronaut Application we want to develop, let&#8217;s first look at the schematic of the whole application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/openapi-generator/server-component-scheme.svg" alt="server component scheme">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller will receive client requests utilizing Micronaut server features.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The controller will call repository methods responsible for interaction with the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The repository methods will be implemented utilizing Micronaut JDBC, and will send queries to the database.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The files we generated with OpenAPI generator include Micronaut features responsible for server-client communication, like parameter and body binding, and JSON conversion.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-storage-and-access-with-mysql-and-jdbc">7. Data Storage And Access With MySQL and JDBC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use MySQL database to store and access data. This will ensure that stored data is persistent between the server runs and can be easily accessed and modified by multiple instances of our application.</p>
</div>
<div class="paragraph">
<p>Before implementing any server logic, we need to create a database and configure a connection to it. We will use Flyway to set up the database schema and JDBC for accessing the data.</p>
</div>
<div class="sect2">
<h3 id="configure-access-for-a-data-source">7.1. Configure Access for a Data Source</h3>
<div class="paragraph">
<p>We will use <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#dbc">Micronaut Data JDBC</a> to access the MySQL data source.</p>
</div>
<div class="paragraph">
<p>Add the following required dependencies:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Add the following to your annotationProcessorPaths element --&gt;</span>
<span class="tag">&lt;path&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.data<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-data-processor<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/path&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.data<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-data-jdbc<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.sql<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-jdbc-hikari<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>mysql-connector-java<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>mysql<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>runtime<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Locally, the database will be provided by <a href="#test-resources">Test Resources</a>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">datasources</span>:
  <span class="key">default</span>: <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">dialect</span>: <span class="string"><span class="content">MYSQL</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="content">${JDBC_DRIVER:com.mysql.cj.jdbc.Driver} </span></span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create datasource called <code>default</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the dialect and driver class name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the configured data source we will be able to access the data using Micronaut JDBC API, which will be shown further in the guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-migration-with-flyway">7.2. Database Migration with Flyway</h3>
<div class="paragraph">
<p>We need a way to create the database schema. For that, we use <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/">Micronaut integration with Flyway</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://www.flywaydb.org">Flyway</a> automates schema changes, significantly simplifying schema management tasks, such as migrating, rolling back, and reproducing in multiple environments.</p>
</div>
<div class="paragraph">
<p>Add the following snippet to include the necessary dependencies:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.flyway<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-flyway<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.flywaydb<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>flyway-mysql<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>runtime<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will enable Flyway in <code>application.yml</code> and configure it to perform migrations on one of the defined data sources.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">flyway</span>:
  <span class="key">datasources</span>:
    <span class="key">default</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable Flyway for the <code>default</code> datasource.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuring multiple data sources is as simple as enabling Flyway for each one. You can also specify directories that will be used for migrating each data source. Review the <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/">Micronaut Flyway documentation</a> for additional details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flyway migration will be automatically triggered before your Micronaut application starts. Flyway will read migration commands in the <code>resources/db/migration/</code> directory, execute them if necessary, and verify that the configured data source is consistent with them.</p>
</div>
<div class="paragraph">
<p>Create the following migration files with the database schema creation:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/db/migration/V1__schema.sql</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> book (
    id  <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span> <span class="directive">AUTO_INCREMENT</span> <span class="directive">UNIQUE</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span>,
    name  <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>) <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    availability  <span class="predefined-type">ENUM</span>(<span class="string"><span class="delimiter">'</span><span class="content">available</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">reserved</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">not available</span><span class="delimiter">'</span></span>) <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    author  <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
    ISBN  <span class="predefined-type">CHAR</span>(<span class="integer">13</span>)
);

<span class="class">INSERT</span> <span class="class">INTO</span> book
    (name, availability, author, ISBN)
<span class="keyword">VALUES</span>
    (<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>,      <span class="string"><span class="delimiter">&quot;</span><span class="content">available</span><span class="delimiter">&quot;</span></span>,   <span class="string"><span class="delimiter">&quot;</span><span class="content">Lewis Caroll</span><span class="delimiter">&quot;</span></span>,   <span class="string"><span class="delimiter">&quot;</span><span class="content">9783161484100</span><span class="delimiter">&quot;</span></span>),
    (<span class="string"><span class="delimiter">&quot;</span><span class="content">The Hitchhiker's Guide to the Galaxy</span><span class="delimiter">&quot;</span></span>,  <span class="string"><span class="delimiter">&quot;</span><span class="content">reserved</span><span class="delimiter">&quot;</span></span>,    <span class="string"><span class="delimiter">&quot;</span><span class="content">Douglas Adams</span><span class="delimiter">&quot;</span></span>,  <span class="predefined-constant">NULL</span>),
    (<span class="string"><span class="delimiter">&quot;</span><span class="content">Java Guide for Beginners</span><span class="delimiter">&quot;</span></span>,              <span class="string"><span class="delimiter">&quot;</span><span class="content">available</span><span class="delimiter">&quot;</span></span>,   <span class="predefined-constant">NULL</span>,             <span class="predefined-constant">NULL</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SQL commands in the migration will create the <code>book</code> table with <code>id</code> and four columns describing its properties, and populate the table with three sampe rows.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-mappedentity">7.3. Creating a MappedEntity</h3>
<div class="paragraph">
<p>To retrieve objects from the database, you need to define a class annotated with <a href="https://micronaut-projects.github.io/micronaut-data/latest/api/io/micronaut/data/annotation/MappedEntity.html">@MappedEntity</a>. Instances of the class will represent a single row retrieved from the database in a query.</p>
</div>
<div class="paragraph">
<p>We will now create <code>BookEntity</code> class. We will be retrieving data from the <code>book</code> table, and therefore class properties match columns in the table. Note that special annotations are added on the property corresponding to the primary key of the table.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookEntity.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">example.micronaut.model.BookAvailability</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.NonNull</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Nullable</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.annotation.GeneratedValue</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.annotation.Id</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.annotation.MappedEntity</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.annotation.MappedProperty</span>;

<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotNull</span>;

<span class="annotation">@MappedEntity</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookEntity</span> {

    <span class="annotation">@Id</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@GeneratedValue</span>(GeneratedValue.Type.AUTO)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;

    <span class="annotation">@NonNull</span>
    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@NonNull</span>
    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> BookAvailability availability;

    <span class="annotation">@Nullable</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> author;

    <span class="annotation">@Nullable</span>
    <span class="annotation">@MappedProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ISBN</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> isbn;

    <span class="directive">public</span> <span class="predefined-type">Long</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="type">void</span> setId(<span class="predefined-type">Long</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="annotation">@NonNull</span>
    <span class="directive">public</span> BookAvailability getAvailability() {
        <span class="keyword">return</span> availability;
    }

    <span class="directive">public</span> <span class="type">void</span> setAvailability(<span class="annotation">@NonNull</span> BookAvailability availability) {
        <span class="local-variable">this</span>.availability = availability;
    }

    <span class="annotation">@Nullable</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getIsbn() {
        <span class="keyword">return</span> isbn;
    }

    <span class="directive">public</span> <span class="type">void</span> setIsbn(<span class="annotation">@Nullable</span> <span class="predefined-type">String</span> isbn) {
        <span class="local-variable">this</span>.isbn = isbn;
    }

    <span class="annotation">@NonNull</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="annotation">@NonNull</span> <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="annotation">@Nullable</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAuthor() {
        <span class="keyword">return</span> author;
    }

    <span class="directive">public</span> <span class="type">void</span> setAuthor(<span class="annotation">@Nullable</span> <span class="predefined-type">String</span> author) {
        <span class="local-variable">this</span>.author = author;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MappedEntity</code> to map the class to the table defined in the schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the ID of an entity</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="writing-a-repository">7.4. Writing a Repository</h3>
<div class="paragraph">
<p>Next, we will create a repository interface and define the required operations to access the database. Micronaut Data will implement the interface at compilation time. It will determine the operations to be implemented based on method naming and parameters, and supports <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#dataUpdates">simple create, read, update, delete operations</a> along with <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#querying">highly-customizable queries</a>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookRepository.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">example.micronaut.model.BookAvailability</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.NonNull</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.jdbc.annotation.JdbcRepository</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.model.query.builder.sql.Dialect</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.repository.GenericRepository</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.repository.jpa.JpaSpecificationExecutor</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.repository.jpa.criteria.PredicateSpecification</span>;

<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotBlank</span>;
<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotNull</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@JdbcRepository</span>(dialect = Dialect.MYSQL) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">BookRepository</span> <span class="directive">extends</span> GenericRepository&lt;BookEntity, <span class="predefined-type">Long</span>&gt;, <i class="conum" data-value="2"></i><b>(2)</b>
        JpaSpecificationExecutor&lt;BookEntity&gt; { <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@NonNull</span>
    <span class="predefined-type">List</span>&lt;BookEntity&gt; findAll(PredicateSpecification&lt;BookEntity&gt; spec);  <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="annotation">@NonNull</span>
    <span class="predefined-type">List</span>&lt;BookEntity&gt; findAll();


    <span class="annotation">@NonNull</span>
    BookEntity save(<span class="annotation">@NonNull</span> <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name,
                    <span class="annotation">@NonNull</span> <span class="annotation">@NotNull</span> BookAvailability availability,
                    <span class="annotation">@NonNull</span> <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> author,
                    <span class="annotation">@NonNull</span> <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> isbn);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@JdbcRepository</code> with a specific dialect.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>BookEntity</code>, the entity to treat as the root entity for the purposes of querying, is established either from the method signature or from the generic type parameter specified to the <code>GenericRepository</code> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Implement the <code>JpaSpecificationExecutor</code> interface when you need create queries dynamically by composing <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#dbcCriteriaSpecifications">JPA criteria</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>To find multiple entities, you can use the <code>findAll</code> method from the <code>JpaSpecificationExecutor</code> interface.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above code snippet, we extended the <code>JpaSpecificationExecutor</code> interface to define a <code>findAll</code> method that supports <code>Predicate</code> as argument, which allows to modify the operations performed during runtime. We will now create a factory class for creating predicates that we plan to use in our application:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookSpecifications.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.NonNull</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.data.repository.jpa.criteria.PredicateSpecification</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BookSpecifications</span> {
    <span class="directive">public</span> <span class="directive">static</span> PredicateSpecification&lt;BookEntity&gt; nameLike(<span class="annotation">@NonNull</span> <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> (root, criteriaBuilder) -&gt; criteriaBuilder.like(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">%</span><span class="delimiter">&quot;</span></span>+name+<span class="string"><span class="delimiter">&quot;</span><span class="content">%</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="directive">static</span> PredicateSpecification&lt;BookEntity&gt; authorLike(<span class="annotation">@NonNull</span> <span class="predefined-type">String</span> author) {
        <span class="keyword">return</span> (root, criteriaBuilder) -&gt; criteriaBuilder.like(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">%</span><span class="delimiter">&quot;</span></span>+author+<span class="string"><span class="delimiter">&quot;</span><span class="content">%</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-controller-logic">8. Writing the Controller Logic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you look inside the generated <code>BookInfo.java</code> file, you can see the class that was generated with all the parameters
based on our definition. Notice that the constructor signature has two parameters, which were defined as <code>required</code> in the
YAML definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> BookInfo(<span class="predefined-type">String</span> name, BookAvailability availability);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with that it has getters and setters for parameters and Jackson serialization annotations.</p>
</div>
<div class="sect2">
<h3 id="implementing-controller-methods">8.1. Implementing Controller Methods</h3>
<div class="paragraph">
<p>Now open <code>BooksController</code>. Thanks to the <a href="https://docs.micronaut.io/latest/guide/#httpServer">@Controller</a> annotation, an instance of the class will be initialized when Micronaut application starts, and the corresponding method will be called when there is a request. The class should also have two methods named the same as the operations we created in the definition file. The methods have Micronaut framework annotations describing the required API. We will now write their bodies.</p>
</div>
<div class="paragraph">
<p>Using the Inversion of Control principle, we will inject <code>BookRepository</code> so it can be used in the methods. When initializing the controller, Micronaut will automatically provide an instance of the repository as a constructor argument:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/controller/BooksController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">final</span> BookRepository bookRepository; <i class="conum" data-value="1"></i><b>(1)</b>

<span class="directive">public</span> BooksController(BookRepository bookRepository) { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="local-variable">this</span>.bookRepository = bookRepository;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use constructor injection to inject a bean of type <code>BookRepository</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, keeping all the generated annotations, add this implementation for the <code>search</code> method:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/controller/BooksController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ExecuteOn</span>(TaskExecutors.IO) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;BookInfo&gt; search(
        <span class="annotation">@QueryValue</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">book-name</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Nullable</span> <span class="annotation">@Size</span>(min=<span class="integer">3</span>) <span class="predefined-type">String</span> bookName,
        <span class="annotation">@QueryValue</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">author-name</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Nullable</span> <span class="predefined-type">String</span> authorName) {
    <span class="keyword">return</span> searchEntities(bookName, authorName)
            .stream()
            .map(<span class="local-variable">this</span>::map) <i class="conum" data-value="5"></i><b>(5)</b>
            .collect(Collectors.toList());
}

<span class="directive">private</span> BookInfo map(BookEntity entity) {
    BookInfo book = <span class="keyword">new</span> BookInfo(entity.getName(), entity.getAvailability());
    book.setISBN(entity.getIsbn());
    book.setAuthor(entity.getAuthor());
    <span class="keyword">return</span> book;
}

<span class="annotation">@NonNull</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;BookEntity&gt; searchEntities(<span class="annotation">@Nullable</span> <span class="predefined-type">String</span> name, <span class="annotation">@Nullable</span> <span class="predefined-type">String</span> author) { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">if</span> (StringUtils.isEmpty(name) &amp;&amp; StringUtils.isEmpty(author)) {
        <span class="keyword">return</span> bookRepository.findAll();
    } <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isEmpty(name)) {
        <span class="keyword">return</span> bookRepository.findAll(BookSpecifications.authorLike(author)); <i class="conum" data-value="3"></i><b>(3)</b>

    } <span class="keyword">else</span>  <span class="keyword">if</span> (StringUtils.isEmpty(author)) {
        <span class="keyword">return</span> bookRepository.findAll(BookSpecifications.nameLike(name));
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> bookRepository.findAll(BookSpecifications.authorLike(author)
                .and(BookSpecifications.nameLike(name))); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is critical that any blocking I/O operations (such as fetching the data from the database) are offloaded to a separate thread pool that does not block the Event loop.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the <code>searchEntities</code> method that will manage the different combinations of desired search parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the predicate we previously defined to search for substring in one column</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the Criteria API to build a query for combined search in the 2 columns during runtime.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Map the <code>BookEntity</code> instances to the desired return type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we will implement the <code>addBook</code> method:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/controller/BooksController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ExecuteOn</span>(TaskExecutors.IO) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Status</span>(OK) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">void</span> addBook(<span class="annotation">@Body</span> <span class="annotation">@NotNull</span> <span class="annotation">@Valid</span> BookInfo bookInfo) {
    bookRepository.save(bookInfo.getName(), <i class="conum" data-value="3"></i><b>(3)</b>
            bookInfo.getAvailability(),
            bookInfo.getAuthor(),
            bookInfo.getISBN());
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is critical that any blocking I/O operations (such as fetching the data from the database) are offloaded to a separate thread pool that does not block the Event loop.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can return <code>void</code> in your controller&#8217;s method and specify the HTTP status code via the <code>@Status</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call the repository method that will add an entry to the table.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-resources">9. Test Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the application is started locally&#8201;&#8212;&#8201;either under test or by <a href="#running-the-application">running the application</a>&#8201;&#8212;&#8201;resolution of the datasource URL is detected and the Test Resources service will start a local MySQL docker container, and inject the properties required to use this as the datasource.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-test-resources/snapshot/guide/#modules-databases-jdbc">JDBC section</a> or <a href="https://micronaut-projects.github.io/micronaut-test-resources/snapshot/guide/#modules-databases-r2dbc">R2DBC section</a> of the Test Resources documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application">10. Running the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the application, use the <code>./mvnw mn:run</code> command, which starts the application on port 8080.</p>
</div>
<div class="paragraph">
<p>You can send a few requests to the paths to test the application. We will use cURL for that.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The search for book names, that have <code>"Guide"</code> as substring should return 2 <code>BookInfo</code> objects:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl &quot;localhost:8080/search?book-name=Guide&quot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[{&quot;name&quot;:&quot;The Hitchhiker's Guide to the Galaxy&quot;,&quot;availability&quot;:&quot;reserved&quot;,&quot;author&quot;:&quot;Douglas Adams&quot;},
{&quot;name&quot;:&quot;Java Guide for Beginners&quot;,&quot;availability&quot;:&quot;available&quot;}]</code></pre>
</div>
</div>
</li>
<li>
<p>The search for a substring <code>"Gu"</code> in name will return a <code>"Bad Request"</code> error, since we have defined the <code>book-name</code> parameter to
have at least three characters:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -i &quot;localhost:8080/search?book-name=Gu&quot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 400 Bad Request
Content-Type: application/json
date: ****
content-length: 180
connection: keep-alive

{&quot;message&quot;:&quot;Bad Request&quot;,&quot;_embedded&quot;:{&quot;errors&quot;:[{&quot;message&quot;:&quot;bookName: size must be between 3 and 2147483647&quot;}]},
&quot;_links&quot;:{&quot;self&quot;:{&quot;href&quot;:&quot;/search?book-name=Gu&quot;,&quot;templated&quot;:false}}}</code></pre>
</div>
</div>
</li>
<li>
<p>Addition of a new book should not result in errors:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -i -d '{&quot;name&quot;: &quot;My book&quot;, &quot;availability&quot;: &quot;available&quot;}' \
  -H 'Content-Type: application/json' -X POST localhost:8080/add</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 200 OK
date: Tue, 1 Feb 2022 00:01:57 GMT
Content-Type: application/json
content-length: 0
connection: keep-alive</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then verify that the addition was successful by performing another search.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">11. Testing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw test</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="testing-models">11.1. Testing Models</h3>
<div class="paragraph">
<p>As we have noticed previously, some files were generated as templates for tests.
We will implement tests for models inside these files. Their main purpose will be to verify that we correctly described
our API in the YAML file, and therefore the generated files behave as expected.</p>
</div>
<div class="paragraph">
<p>We will begin by writing tests for the required properties of <code>BookInfo</code> object.
Define the following imports:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/example/micronaut/model/BookInfoTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Property</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Requires</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Produces</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.annotation.Client</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.test.extensions.junit5.annotation.MicronautTest</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.PermitAll</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">javax.validation.Validator</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions</span>.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following methods inside the <code>BookInfoTest</code> class:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/example/micronaut/model/BookInfoTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Inject</span>
    <span class="predefined-type">Validator</span> validator; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> nameTest() {
        BookInfo bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE);
        assertTrue(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="2"></i><b>(2)</b>

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="predefined-constant">null</span>, BookAvailability.AVAILABLE);
        assertFalse(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> availabilityTest() { <i class="conum" data-value="4"></i><b>(4)</b>
        BookInfo bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">ALice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.RESERVED);
        assertTrue(validator.validate(bookInfo).isEmpty());

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
        assertFalse(validator.validate(bookInfo).isEmpty());
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instruct Micronaut to inject an instance of the <a href="https://docs.micronaut.io/latest/guide/#beanValidation">Validator</a>.
<code>Validator</code> will automatically validate parameters and response bodies annotated with <code>@Valid</code> in the controller.
We will use it to test the validations manually.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Verify that the validator doesn&#8217;t produce any violations on a correct <code>BookInfo</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Verify that <code>null</code> value is not allowed for the <code>name</code> property, since the property is marked as required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Perform the same tests for the required <code>availability</code> property.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will then write similar tests for other properties:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/example/micronaut/model/BookInfoTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> authorTest() {
        BookInfo bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .author(<span class="predefined-constant">null</span>);
        assertTrue(validator.validate(bookInfo).isEmpty());

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .author(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lewis Carroll</span><span class="delimiter">&quot;</span></span>);
        assertTrue(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="1"></i><b>(1)</b>

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .author(<span class="string"><span class="delimiter">&quot;</span><span class="content">fo</span><span class="delimiter">&quot;</span></span>);
        assertFalse(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> ISBNTest() {
        BookInfo bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .ISBN(<span class="predefined-constant">null</span>);
        assertTrue(validator.validate(bookInfo).isEmpty());

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .ISBN(<span class="string"><span class="delimiter">&quot;</span><span class="content">9783161484100</span><span class="delimiter">&quot;</span></span>);
        assertTrue(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="3"></i><b>(3)</b>

        bookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .ISBN(<span class="string"><span class="delimiter">&quot;</span><span class="content">9783161 84100</span><span class="delimiter">&quot;</span></span>);
        assertFalse(validator.validate(bookInfo).isEmpty()); <i class="conum" data-value="4"></i><b>(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Verify that there are no violations for both <code>null</code> or <code>"Lewis Carol"</code> used as a value for the <code>author</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Verify that there is a violation if the name is too short (at least tree characters are required).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Verify that there are no violations for valid values of the <code>ISBN</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Verify that there is a violation if the value doesn&#8217;t match the required pattern (A space is present).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we will test JSON serialization and parsing by writing a simple controller and client:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/example/micronaut/model/BookInfoTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Property</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">spec.name</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">BookInfoTest</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@MicronautTest</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookInfoTest</span> {

    <span class="annotation">@Inject</span>
    <span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    HttpClient httpClient;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> bookInfoJsonSerialization() {
        BookInfo requiredBookInfo = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                .author(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lewis Carroll</span><span class="delimiter">&quot;</span></span>)
                .ISBN(<span class="string"><span class="delimiter">&quot;</span><span class="content">9783161484100</span><span class="delimiter">&quot;</span></span>);

        BookInfo bookInfo = httpClient.toBlocking().retrieve(HttpRequest.GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/bookinfo</span><span class="delimiter">&quot;</span></span>), BookInfo.class); <i class="conum" data-value="5"></i><b>(5)</b>
        assertEquals(requiredBookInfo, bookInfo);
    }

    <span class="annotation">@Requires</span>(property = <span class="string"><span class="delimiter">&quot;</span><span class="content">spec.name</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">BookInfoTest</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/bookinfo</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">BookInfoSerdeController</span> {
        <span class="annotation">@PermitAll</span>
        <span class="annotation">@Get</span>
        BookInfo index() { <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="keyword">return</span> <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice's Adventures in Wonderland</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE)
                    .author(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lewis Carroll</span><span class="delimiter">&quot;</span></span>)
                    .ISBN(<span class="string"><span class="delimiter">&quot;</span><span class="content">9783161484100</span><span class="delimiter">&quot;</span></span>);
        }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a simple controller that will respond to requests on the <code>/bookinfo</code> path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the <code>spec.name</code> property for this test class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the <a href="https://docs.micronaut.io/latest/guide/#metaScopes">Requires</a> annotation to specify that
this controller will only be used if the <code>spec.name</code> property is set to <code>BookInfoTest</code>. This will prevent the controller
from running during other tests.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define a <code>GET</code> method that will return a <code>BookInfo</code> object in the <code>application/json</code> format.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create a test that will send a request to the server and verify that the response matches the desired object
(This means that both serialization and parsing work correctly).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly, we can implement tests for the <code>BookAvailability</code> class. The details are not shown in this guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-the-controller">11.2. Testing the Controller</h3>
<div class="paragraph">
<p>We will write tests for the two paths of <code>BookController</code>.</p>
</div>
<div class="paragraph">
<p>If you open the <code>BooksControllerTest</code>, you can see that templates of tests were generated for both paths with examples of requests to corresponding paths. The templates can be used to simplify and speed up test writing.</p>
</div>
<div class="paragraph">
<p>We will simply replace the contents of the file:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/example/micronaut/controller/BooksControllerTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut.controller</span>;

<span class="keyword">import</span> <span class="include">example.micronaut.model.BookAvailability</span>;
<span class="keyword">import</span> <span class="include">example.micronaut.model.BookInfo</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.uri.UriBuilder</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.test.extensions.junit5.annotation.MicronautTest</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.annotation.Client</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.MutableHttpRequest</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpResponse</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.core.type.Argument</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@MicronautTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BooksControllerTest</span> {

    <span class="annotation">@Inject</span>
    <span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${context-path}</span><span class="delimiter">&quot;</span></span>)
    HttpClient client; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@Test</span>
    <span class="type">void</span> addBookClientApiTest() {
        BookInfo body = <span class="keyword">new</span> BookInfo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>, BookAvailability.AVAILABLE);
        body.setAuthor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sam Newman</span><span class="delimiter">&quot;</span></span>);
        body.setISBN(<span class="string"><span class="delimiter">&quot;</span><span class="content">9781492034025</span><span class="delimiter">&quot;</span></span>);
        HttpResponse&lt;?&gt; response = client.toBlocking()
                .exchange(HttpRequest.POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/add</span><span class="delimiter">&quot;</span></span>, body)); <i class="conum" data-value="3"></i><b>(3)</b>
        assertEquals(HttpStatus.OK, response.status()); <i class="conum" data-value="4"></i><b>(4)</b>
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> searchClientApiTest() {
        HttpResponse&lt;<span class="predefined-type">List</span>&lt;BookInfo&gt;&gt; response = client.toBlocking()
                .exchange(HttpRequest.GET(UriBuilder.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search</span><span class="delimiter">&quot;</span></span>)
                        .queryParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">book-name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Guide</span><span class="delimiter">&quot;</span></span>)
                        .build()
                ), Argument.listOf(BookInfo.class)); <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="predefined-type">List</span>&lt;BookInfo&gt; body = response.body(); <i class="conum" data-value="6"></i><b>(6)</b>
        assertEquals(HttpStatus.OK, response.status());
        assertEquals(<span class="integer">2</span>, body.size()); <i class="conum" data-value="7"></i><b>(7)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> so the Micronaut framework will initialize the application context and the embedded server. <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/">More info</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>HttpClient</code> bean and point it to the embedded server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creating HTTP Requests is easy thanks to the Micronaut framework fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Verify that addition of book info was successful by checking the status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Micronaut HTTP Client simplifies binding a JSON array to a list of POJOs by using <code>Argument::listOf</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use <code>.body()</code> to retrieve the parsed payload.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Verify that there are exactly two books with <code>"Guide"</code> substring in title.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw test</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the tests should run successfully.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-application-native-executable-with-graalvm">12. Generate a Micronaut Application Native Executable with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use <a href="https://www.graalvm.org/">GraalVM</a>, the polyglot embeddable virtual machine, to generate a native executable of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Compiling native executables ahead of time with GraalVM improves startup time and reduces the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only Java and Kotlin projects support using GraalVM&#8217;s <code>native-image</code> tool. Groovy relies heavily on reflection, which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="native-executable-generation">12.1. Native executable generation</h3>
<div class="paragraph">
<p>The easiest way to install GraalVM on Linux or Mac is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="title">Java 11</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r11-grl</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you still use Java 8, use the JDK11 version of GraalVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Java 17</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sdk install java 22.3.r17-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>For installation on Windows, or for manual installation on Linux or Mac, see the <a href="https://www.graalvm.org/22.0/docs/getting-started/">GraalVM Getting Started</a> documentation.</p>
</div>
<div class="paragraph">
<p>After installing GraalVM, install the <code>native-image</code> component, which is not installed by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a native executable using Maven, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw package -Dpackaging=native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable is created in the <code>target</code> directory and can be run with <code>target/micronautguide</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">13. Next steps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="learn-more">13.1. Learn More</h3>
<div class="paragraph">
<p>Read OpenAPI and Micronaut documentation and guides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.openapis.org">OpenAPI</a></p>
</li>
<li>
<p><a href="https://openapi-generator.tech">OpenAPI Generator</a></p>
</li>
<li>
<p>Definition files generation from annotated controllers with <a href="https://micronaut-projects.github.io/micronaut-openapi/latest/guide">Micronaut OpenAPI</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-data/latest/guide">Micronaut Data</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="add-security">13.2. Add Security</h3>
<div class="paragraph">
<p>We could have defined our security requirements by adding a security schema to the <code>library-definition.yaml</code> file.
For example, we will add HTTP Basic authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">paths</span>:
  <span class="key">/search</span>:
    <span class="comment"># ... #</span>
  <span class="key">/add</span>:
    <span class="key">post</span>:
      <span class="comment"># ... #</span>
      <span class="key">security</span>:
        - <span class="string"><span class="content">MyBasicAuth: [] </span></span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="key">components</span>:
  <span class="key">schemas</span>:
    <span class="comment"># ... #</span>
  <span class="key">securitySchemes</span>:
    <span class="key">MyBasicAuth</span>: <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">type</span>: <span class="string"><span class="content">http</span></span>
      <span class="key">scheme</span>: <span class="string"><span class="content">basic</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a security schema inside the <code>components/securitySchemes</code>. We want to use Basic auth for authentication.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the schema to the paths that you want to secure. In this case, we want to restrict access to
adding books into our library.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can read more about describing various authentication in the
<a href="https://swagger.io/docs/specification/authentication/">"Authentication and Authorization" OpenAPI guide</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generator will then annotate such endpoints with the
<a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/#secured">Secured</a> annotation accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Secured</span>(SecurityRule.IS_AUTHENTICATED)
<span class="directive">public</span> Mono&lt;<span class="predefined-type">Object</span>&gt; addBook( <span class="comment">/* ... */</span> ){ <span class="comment">/* ... */</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will then need to implement an
<a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/#authenticationProviders">AuthenticationProvider</a>
that satisfies your needs. If you want to finish implementing the basic authentication, continue to the
<a href="https://guides.micronaut.io/latest/micronaut-security-basicauth.html">Micronaut Basic Auth guide</a> and replicate
steps to create the <code>AuthenticationProvider</code> and appropriate tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also read <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/">Micronaut Security documentation</a>
or <a href="https://micronaut.io/guides">Micronaut guides</a> about security to learn more about
the supported Authorization strategies.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="generate-micronaut-client">13.3. Generate Micronaut Client</h3>
<div class="paragraph">
<p>You can generate a Micronaut client based on the same <code>library-definition.yaml</code> file.</p>
</div>
<div class="paragraph">
<p>Run the following in terminal to create client in the <code>library-client</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar openapi-generator-cli-XXX.jar generate \
    -g java-micronaut-client \
    -i library-definition.yaml \
    -o library-client \
    -p apiPackage=example.micronaut.api \
    -p modelPackage=example.micronaut.model \
    -p build=maven \
    -p test=junit</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="add-server-url-information">13.4. Add Server URL Information</h3>
<div class="paragraph">
<p>If you have your server running, you can add your website URL to it in the YAML definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># ... #</span>
<span class="key">servers</span>:
  - <span class="string"><span class="content">url: 'http://my.website.com'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generate-user-friendly-documentation">13.5. Generate User-Friendly Documentation</h3>
<div class="paragraph">
<p>You can generate documentation in html file inside the <code>html-docs/</code> directory by running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar openapi-generator-cli-XXX.jar generate \
    -g html2 \
    -i library-definition.yaml \
    -o html-docs</code></pre>
</div>
</div>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="./images/micronaut_foundation_horizontal_white.svg" alt="Micronaut Foundation"/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronautpodcast.com"><i class="fa fa-podcast"><span class="sr-only">Podcast</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="https://micronaut.io/feed/rss/"><i class="fa fa-feed"><span class="sr-only">Feed</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom "><a href="mailto:info@micronaut.io"><i class="fas fa-envelope"><span class="sr-only">Mail</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://twitter.com/micronautfw"><i class="fab fa-twitter"><span class="sr-only">Twitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://matrix.to/#/#micronautfw_questions:gitter.im"><i class="fab fa-gitter"><span class="sr-only">Gitter</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/micronaut-projects/"><i class="fab fa-github"><span class="sr-only">GitHub</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.youtube.com/@MicronautFramework"><i class="fab fa-youtube"><span class="sr-only">YouTube</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.linkedin.com/showcase/micronaut"><i class="fab fa-linkedin"><span class="sr-only">LinkedIn</span></i></a></li>
                            <li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.twitch.tv/micronautfw"><i class="fab fa-twitch"><span class="sr-only">Twitch</span></i></a></li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2023 MICRONAUT FOUNDATION. ALL RIGHTS RESERVED</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>
